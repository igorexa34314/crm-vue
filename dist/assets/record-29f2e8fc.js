import{d as T,U as F,a as N,u as q,j as V,W as E,c as g,a4 as L,r as k,b as d,y as S,M as w,t as p,p as t,i as o,e as x,n as y,g as l,f,a5 as $,a6 as j,a7 as B,$ as R,v as z,B as A,a1 as D,l as G,Z as H}from"./index-9175fc32.js";import{u as W}from"./userinfo-fa9419c8.js";import{f as Z}from"./category-ce40ea36.js";import{c as J}from"./record-fbf39380.js";import{r as h}from"./validations-7b6bca79.js";import{m as K}from"./messages-e76e0baf.js";import"./auth-f7cc9485.js";const O={class:"title"},P={class:"text-h4 mt-4 ml-2"},Q={key:1,class:"mt-10 text-center text-h6"},re=T({__name:"record",setup(X){F({title:"pageTitles.newRecord"});const{showMessage:v}=N(),C=q(),b=V(),i=V(""),e=E({amount:100,description:"",type:"outcome"}),u=g(()=>C.info),I=g(()=>e.type==="income"?!0:u.value.bill>=e.amount),{state:_,isLoading:U}=L(Z,[],{onError:n=>{},onSuccess:n=>{i.value=(n==null?void 0:n[0].id)||""}}),M=async()=>{var a,c,m;if(((c=await((a=b.value)==null?void 0:a.validate()))==null?void 0:c.valid)&&I.value)try{await J({categoryId:i.value,amount:e.amount,description:e.description,type:e.type});const s=e.type==="income"?u.value.bill+e.amount:u.value.bill-e.amount;await W({bill:s}),v(o("createRecord_success")),(m=b.value)==null||m.reset(),e.amount=1}catch(s){v(K[s]||s)}else v(o("lack_of_amount")+` (${e.amount-u.value.bill})`)};return(n,a)=>{var s;const c=k("app-loader"),m=k("router-link");return d(),S("div",null,[w("div",O,[w("h3",P,p(t(o)("pageTitles.newRecord")),1)]),t(U)?(d(),x(c,{key:0,class:"mt-10",page:""})):(s=t(_))!=null&&s.length?(d(),x(t(H),{key:2,ref_key:"form",ref:b,onSubmit:G(M,["prevent"]),class:"record-form mt-8 px-4"},{default:f(()=>[l($,{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=r=>i.value=r),items:t(_),"item-title":"title","item-value":"id",label:t(o)("select_category"),variant:"underlined"},null,8,["modelValue","items","label"]),l(j,{class:"mt-3",modelValue:e.type,"onUpdate:modelValue":a[1]||(a[1]=r=>e.type=r)},{default:f(()=>[l(B,{label:t(o)("income"),value:"income",density:"comfortable",color:"orange-accent-3"},null,8,["label"]),l(B,{label:t(o)("outcome"),value:"outcome",density:"comfortable",color:"orange-accent-3"},null,8,["label"])]),_:1},8,["modelValue"]),l(R,{modelValue:e.amount,"onUpdate:modelValue":a[2]||(a[2]=r=>e.amount=r),modelModifiers:{number:!0},rules:t(h).amount,type:"number",variant:"underlined",label:t(o)("amount"),class:"mt-2",required:""},null,8,["modelValue","rules","label"]),l(R,{modelValue:e.description,"onUpdate:modelValue":a[3]||(a[3]=r=>e.description=r),rules:t(h).description,variant:"underlined",label:t(o)("description"),class:"mt-2",required:""},null,8,["modelValue","rules","label"]),l(z,{type:"submit",color:"light-blue-darken-4",class:"mt-7"},{default:f(()=>[y(p(t(o)("create"))+" ",1),l(A,{icon:t(D),class:"ml-3"},null,8,["icon"])]),_:1})]),_:1},8,["onSubmit"])):(d(),S("div",Q,[y(p(t(o)("no_categories")+". ")+" ",1),l(m,{to:"/categories"},{default:f(()=>[y(p(t(o)("create_category")),1)]),_:1})]))])}}});export{re as default};
