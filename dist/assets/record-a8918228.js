import{d as L,U as q,u as z,b as G,a as H,k as g,c as x,r as h,f as p,z as w,K as U,t as f,q as e,g as C,p as V,i as n,h as _,a2 as K,a3 as O,a4 as B,x as Y,C as j,$ as J,m as P,Y as Q}from"./index-906b0197.js";import{_ as R,r as I}from"./validations-32d67446.js";import{a as W}from"./index-937a8055.js";import{u as X}from"./user-a397025f.js";import{u as Z,f as ee}from"./useCurrencyFilter-c40ad87d.js";import{c as ae}from"./record-91accc22.js";import{m as F}from"./fbMessages-e76e0baf.js";import"./auth-7a072a28.js";const te={class:"title"},oe={class:"text-h4 mt-4 ml-2"},le={key:1,class:"mt-10 text-center text-h6"},pe=L({__name:"record",setup(re){q({title:"pageTitles.newRecord"});const{t:a,n:M}=z({inheritLocale:!0,useScope:"global"}),{showMessage:c}=G(),{currencyFilter:u}=Z(),S=Math.round(u.value(100)),T=H(),b=g(),m=g(""),t=g({amount:S,description:"",type:"outcome"}),i=x(()=>T.info),D=x(()=>t.value.type==="income"?!0:u.value(i.value.bill)>=t.value.amount),{state:k,isLoading:N}=W(ee,[],{onError:r=>{c(F[r]||a("error_load_categories"))},onSuccess:r=>{m.value=(r==null?void 0:r[0].id)||""}}),$=async()=>{var r,o,d,v;if(D.value){if((o=await((r=b.value)==null?void 0:r.validate()))==null?void 0:o.valid)try{const{amount:s,...l}=t.value;await ae({...l,amount:u.value(s,void 0,"reverse"),categoryId:m.value});const{type:A}=l,E=A==="income"?i.value.bill+u.value(s,void 0,"reverse"):i.value.bill-u.value(s,void 0,"reverse");await X({bill:+E.toFixed(2)}),c(a("createRecord_success")),(d=b.value)==null||d.reset(),t.value.amount=S}catch(s){c(F[s]||s)}}else c(a("lack_of_amount")+` (${M(t.value.amount-u.value(i.value.bill),"currency",((v=i.value)==null?void 0:v.currency)||"USD")})`)};return(r,o)=>{var y;const d=h("app-loader"),v=h("router-link");return p(),w("div",null,[U("div",te,[U("h3",oe,f(e(a)("pageTitles.newRecord")),1)]),e(N)?(p(),C(d,{key:0,class:"mt-10",page:""})):(y=e(k))!=null&&y.length?(p(),C(e(Q),{key:2,ref_key:"form",ref:b,onSubmit:P($,["prevent"]),class:"record-form mt-8 px-4"},{default:_(()=>{var s;return[n(K,{modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=l=>m.value=l),items:e(k),"item-title":"title","item-value":"id",label:e(a)("select_category"),variant:"underlined"},null,8,["modelValue","items","label"]),n(O,{class:"mt-3",modelValue:t.value.type,"onUpdate:modelValue":o[1]||(o[1]=l=>t.value.type=l)},{default:_(()=>[n(B,{label:e(a)("income"),value:"income",density:"comfortable",color:"orange-accent-3"},null,8,["label"]),n(B,{label:e(a)("outcome"),value:"outcome",density:"comfortable",color:"orange-accent-3"},null,8,["label"])]),_:1},8,["modelValue"]),n(R,{modelValue:t.value.amount,"onUpdate:modelValue":o[2]||(o[2]=l=>t.value.amount=l),modelModifiers:{number:!0},rules:e(I).amount,type:"number",variant:"underlined",label:e(a)("amount")+` (${(s=i.value)==null?void 0:s.currency})`,class:"mt-2",required:""},null,8,["modelValue","rules","label"]),n(R,{modelValue:t.value.description,"onUpdate:modelValue":o[3]||(o[3]=l=>t.value.description=l),rules:e(I).description,variant:"underlined",label:e(a)("description"),class:"mt-2"},null,8,["modelValue","rules","label"]),n(Y,{type:"submit",color:"light-blue-darken-4",class:"mt-7"},{default:_(()=>[V(f(e(a)("create"))+" ",1),n(j,{icon:e(J),class:"ml-3"},null,8,["icon"])]),_:1})]}),_:1},8,["onSubmit"])):(p(),w("div",le,[V(f(e(a)("no_categories")+". ")+" ",1),n(v,{to:"/categories"},{default:_(()=>[V(f(e(a)("create_category")),1)]),_:1})]))])}}});export{pe as default};
